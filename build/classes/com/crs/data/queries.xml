<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Employee">
	
	<resultMap id="result" type="com.crs.model.EmployeeForm">
	    <result property="employeeID" column="employee_id"/>
	    <result property="emailID" column="email"/>
	    <result property="password" column="password"/>
	    <result property="salt" column="salt"/>
	    <result property="firstName" column="first_name"/>
	    <result property="lastName" column="last_name"/>
	    <result property="securityQn" column="sec_question"/>
	    <result property="phoneNo" column="phone"/>
	    <result property="notifyType" column="notify_type"/>
	    <result property="address" column="address"/>
	    <result property="dateJoined" column="date_joined"/>
	    <result property="points" column="points"/>
    </resultMap>
    
    <resultMap type="com.crs.model.CarPoolForm" id="result2">
    	<result property="carpoolId" column="carpool_id"/>
    	<result property="dateCreated" column="date_created"/>
    	<result property="atWork" column="at_work"/>
    	<result property="noOfMembers" column="noOfMembers"/>
    </resultMap>
	
    <select id="getRecord" parameterType="Employee" resultMap="result">
    	SELECT * FROM EMPLOYEE WHERE EMAIL = #{emailID} AND PASSWORD = #{password} 
    </select>
    
    <insert id="insertRecord" parameterType="Employee">
    	INSERT INTO EMPLOYEE (EMPLOYEE_ID, EMAIL,PASSWORD, SALT, FIRST_NAME, LAST_NAME, SEC_QUESTION, SECURITY_ANS, PHONE, NOTIFY_TYPE, ADDRESS, DATE_JOINED, POINTS)
    	VALUES (#{employeeID},#{emailID},#{password},#{salt},#{firstName},#{lastName},#{securityQn},#{securityAns},#{phoneNo},#{notifyType},#{address},#{dateJoined},#{points})  
    </insert>
    
    <select id="getCarPoolGroup" resultMap = "result2">
    	SELECT * FROM CARPOOL WHERE NOOFMEMBERS &lt; 4 ORDER BY DATE_CREATED DESC LIMIT 1 
    </select>
    
    <!-- select id="getById" parameterType="int" resultMap="result">
    	SELECT * FROM CONTACT WHERE CONTACT_ID = #{id}
  	</select>
    
    <delete id="deleteById" parameterType="int">
    	DELETE from CONTACT WHERE CONTACT_ID = #{id};
    </delete>

    <insert id="insert" parameterType="Contact">
    INSERT INTO CONTACT (CONTACT_EMAIL, CONTACT_NAME, CONTACT_PHONE) 
		VALUES (#{name}, #{phone}, #{email});
      <selectKey keyProperty="id" resultType="int" order="AFTER">
		select last_insert_id() as id
	  </selectKey>
    </insert>

	<update id="update" parameterType="Contact">
	  	UPDATE CONTACT
		SET
			CONTACT_EMAIL = #{email},
			CONTACT_NAME = #{name},
			CONTACT_PHONE = #{phone}
		WHERE CONTACT_ID = #{id};
  </update -->
</mapper>