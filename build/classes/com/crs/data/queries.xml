<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Employee">
	
	<resultMap id="result" type="com.crs.model.EmployeeForm">
	    <result property="employeeID" column="employee_id"/>
	    <result property="emailID" column="email"/>
	    <result property="password" column="password"/>
	    <result property="salt" column="salt"/>
	    <result property="firstName" column="first_name"/>
	    <result property="lastName" column="last_name"/>
	    <result property="securityQn" column="sec_question"/>
	    <result property="securityAn" column="sec_answer"/>
	    <result property="phoneNo" column="phone"/>
	    <result property="notifyType" column="notify_type"/>
	    <result property="address" column="address"/>
	    <result property="dateJoined" column="date_joined"/>
	    <result property="points" column="points"/>
    </resultMap>
    
    <resultMap type="com.crs.model.CarPoolForm" id="result2">
    	<result property="carpoolId" column="carpool_id"/>
    	<result property="dateCreated" column="date_created"/>
    	<result property="atWork" column="at_work"/>
    	<result property="noOfMembers" column="noOfMembers"/>
    </resultMap>
	
    <select id="getRecord" parameterType="Employee" resultMap="result">
    	SELECT * FROM Employee WHERE employee_id = #{employeeID}
    </select>
    
    <insert id="insertRecord" parameterType="Employee">
    	INSERT INTO EMPLOYEE (EMPLOYEE_ID, EMAIL,PASSWORD, SALT, FIRST_NAME, LAST_NAME, SEC_QUESTION, SECURITY_ANS, PHONE, NOTIFY_TYPE, ADDRESS, DATE_JOINED, POINTS)
    	VALUES (#{employeeID},#{emailID},#{password},#{salt},#{firstName},#{lastName},#{securityQn},#{securityAns},#{phoneNo},#{notifyType},#{address},#{dateJoined},#{points})  
    </insert>
    
    <insert id="createNewMember" parameterType="com.crs.model.CarPoolMemberForm">
    	INSERT INTO CARPOOLMEMBER (DATE_JOINED, IS_DRIVER, PICK_UP, IS_TEMPORRARY, EMPLOYEE_ID, CARPOOL_ID) 
    	VALUES (#{dateJoined}, #{isDriver}, #{isPickUp}, #{isTemporary}, #{employee.employeeID}, #{carpoolId});
    	UPDATE CARPOOL SET NOOFMEMBERS = NOOFMEMBERS + 1 WHERE CARPOOL_ID = #{carpoolId}; 
    </insert>
    
    <insert id="createNewCarPoolGroup">
    	INSERT INTO CARPOOL (AT_WORK, DATE_CREATED) VALUES (1, NOW())
    </insert>
    
    <select id="getCarPoolGroup" resultMap = "result2">
    	SELECT * FROM CARPOOL WHERE NOOFMEMBERS &lt; 4 ORDER BY DATE_CREATED DESC LIMIT 1 
    </select>
    
    
    <!-- select id="getById" parameterType="int" resultMap="result">
    	SELECT * FROM CONTACT WHERE CONTACT_ID = #{id}
  	</select-->
  	
    <update id="updateRecord" parameterType="Employee">
    	UPDATE Employee SET phone = #{phoneNo}, address = #{address}, password = #{password} WHERE employee_id = #{employeeID}
    </update>

    
    <!--  insert id="insertRecord" parameterType="Employee">
    	INSERT INTO Employee (email,password,salt,first_name,last_name,sec_question,sec_answer,phone,address)
		VALUES (#{emailID},#{password},#{salt},#{firstName},#{lastName},#{securityQn},#{securityAn},#{phoneNo},#{address})  
    </insert-->
    
    <update id="updatePoints" parameterType="Employee">
    	UPDATE Employee SET points = #{points} WHERE employee_id = #{employeeID}
    </update>
</mapper>